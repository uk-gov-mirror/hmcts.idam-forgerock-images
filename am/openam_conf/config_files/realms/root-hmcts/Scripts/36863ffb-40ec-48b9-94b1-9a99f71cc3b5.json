{
  "metadata" : {
    "realm" : "/AMSTER{project}",
    "amsterVersion" : "AMSTER{amsterVersion}",
    "entityType" : "Scripts",
    "entityId" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "name" : "OIDC Claims Script",
    "description" : "Default global script for OIDC claims",
    "script" : "LyoKICogQ29weXJpZ2h0IDIwMTQtMjAxNyBGb3JnZVJvY2sgQVMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQKICoKICogVXNlIG9mIHRoaXMgY29kZSByZXF1aXJlcyBhIGNvbW1lcmNpYWwgc29mdHdhcmUgbGljZW5zZSB3aXRoIEZvcmdlUm9jayBBUy4KICogb3Igd2l0aCBvbmUgb2YgaXRzIGFmZmlsaWF0ZXMuIEFsbCB1c2Ugc2hhbGwgYmUgZXhjbHVzaXZlbHkgc3ViamVjdAogKiB0byBzdWNoIGxpY2Vuc2UgYmV0d2VlbiB0aGUgbGljZW5zZWUgYW5kIEZvcmdlUm9jayBBUy4KICovCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFJlcG9FeGNlcHRpb24KaW1wb3J0IGNvbS5zdW4uaWRlbnRpdHkuaWRtLklkVHlwZQppbXBvcnQgb3JnLmZvcmdlcm9jay5vYXV0aDIuY29yZS5Vc2VySW5mb0NsYWltcwoKLyoKKiBEZWZpbmVkIHZhcmlhYmxlczoKKiBsb2dnZXIgLSBhbHdheXMgcHJlc2VudHMsIHRoZSAiT0F1dGgyUHJvdmlkZXIiIGRlYnVnIGxvZ2dlciBpbnN0YW5jZQoqIGNsYWltcyAtIGFsd2F5cyBwcmVzZW50LCBkZWZhdWx0IHNlcnZlciBwcm92aWRlZCBjbGFpbXMKKiBzZXNzaW9uIC0gcHJlc2VudCBpZiB0aGUgcmVxdWVzdCBjb250YWlucyB0aGUgc2Vzc2lvbiBjb29raWUsIHRoZSB1c2VyJ3Mgc2Vzc2lvbiBvYmplY3QKKiBpZGVudGl0eSAtIGFsd2F5cyBwcmVzZW50LCB0aGUgaWRlbnRpdHkgb2YgdGhlIHJlc291cmNlIG93bmVyCiogc2NvcGVzIC0gYWx3YXlzIHByZXNlbnQsIHRoZSByZXF1ZXN0ZWQgc2NvcGVzCiogcmVxdWVzdGVkQ2xhaW1zIC0gTWFwPFN0cmluZywgU2V0PFN0cmluZz4+CiogICAgICAgICAgICAgICAgICBhbHdheXMgcHJlc2VudCwgbm90IGVtcHR5IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIGEgY2xhaW1zIHBhcmFtZXRlciBhbmQgc2VydmVyIGhhcyBlbmFibGVkCiogICAgICAgICAgICAgICAgICBjbGFpbXNfcGFyYW1ldGVyX3N1cHBvcnRlZCwgbWFwIG9mIHJlcXVlc3RlZCBjbGFpbXMgdG8gcG9zc2libGUgdmFsdWVzLCBvdGhlcndpc2UgZW1wdHksCiogICAgICAgICAgICAgICAgICByZXF1ZXN0ZWQgY2xhaW1zIHdpdGggbm8gcmVxdWVzdGVkIHZhbHVlcyB3aWxsIGhhdmUgYSBrZXkgYnV0IG5vIHZhbHVlIGluIHRoZSBtYXAuIEEga2V5IHdpdGgKKiAgICAgICAgICAgICAgICAgIGEgc2luZ2xlIHZhbHVlIGluIGl0cyBTZXQgaW5kaWNhdGVzIHRoaXMgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBzaG91bGQgYmUgcmV0dXJuZWQuCiogUmVxdWlyZWQgdG8gcmV0dXJuIGEgTWFwIG9mIGNsYWltcyB0byBiZSBhZGRlZCB0byB0aGUgaWRfdG9rZW4gY2xhaW1zCioKKiBFeHBlY3RlZCByZXR1cm4gdmFsdWUgc3RydWN0dXJlOgoqIFVzZXJJbmZvQ2xhaW1zIHsKKiAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IHZhbHVlczsgLy8gVGhlIHZhbHVlcyBvZiB0aGUgY2xhaW1zIGZvciB0aGUgdXNlciBpbmZvcm1hdGlvbgoqICAgIE1hcDxTdHJpbmcsIExpc3Q8U3RyaW5nPj4gY29tcG9zaXRlU2NvcGVzOyAvLyBNYXBwaW5nIG9mIHNjb3BlIG5hbWUgdG8gYSBsaXN0IG9mIGNsYWltIG5hbWVzLgoqIH0KKi8KCi8vIHVzZXIgc2Vzc2lvbiBub3QgZ3VhcmFudGVlZCB0byBiZSBwcmVzZW50CmJvb2xlYW4gc2Vzc2lvblByZXNlbnQgPSBzZXNzaW9uICE9IG51bGwKCmRlZiBmcm9tU2V0ID0geyBjbGFpbSwgYXR0ciAtPgogICAgaWYgKGF0dHIgIT0gbnVsbCAmJiBhdHRyLnNpemUoKSA9PSAxKXsKICAgICAgICBhdHRyLml0ZXJhdG9yKCkubmV4dCgpCiAgICB9IGVsc2UgaWYgKGF0dHIgIT0gbnVsbCAmJiBhdHRyLnNpemUoKSA+IDEpewogICAgICAgIGF0dHIKICAgIH0gZWxzZSBpZiAobG9nZ2VyLndhcm5pbmdFbmFibGVkKCkpIHsKICAgICAgICBsb2dnZXIud2FybmluZygiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTogR290IGFuIGVtcHR5IHJlc3VsdCBmb3IgY2xhaW09JGNsYWltIik7CiAgICB9Cn0KCmF0dHJpYnV0ZVJldHJpZXZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHksIHJlcXVlc3RlZCAtPgogICAgaWYgKHJlcXVlc3RlZCA9PSBudWxsIHx8IHJlcXVlc3RlZC5pc0VtcHR5KCkpIHsKICAgICAgICBmcm9tU2V0KGNsYWltLCBpZGVudGl0eS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSkKICAgIH0gZWxzZSBpZiAocmVxdWVzdGVkLnNpemUoKSA9PSAxKSB7CiAgICAgICAgcmVxdWVzdGVkLml0ZXJhdG9yKCkubmV4dCgpCiAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJObyBzZWxlY3Rpb24gbG9naWMgZm9yICRjbGFpbSBkZWZpbmVkLiBWYWx1ZXM6ICRyZXF1ZXN0ZWQiKQogICAgfQp9CgovLyBbIHtjbGFpbX06IHthdHRyaWJ1dGUgcmV0cmlldmVyfSwgLi4uIF0KY2xhaW1BdHRyaWJ1dGVzID0gWwogICAgICAgICJlbWFpbCI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgibWFpbCIpLAogICAgICAgICJhZGRyZXNzIjogeyBjbGFpbSwgaWRlbnRpdHksIHJlcXVlc3RlZCAtPiBbICJmb3JtYXR0ZWQiIDogYXR0cmlidXRlUmV0cmlldmVyKCJwb3N0YWxhZGRyZXNzIiwgY2xhaW0sIGlkZW50aXR5LCByZXF1ZXN0ZWQpIF0gfSwKICAgICAgICAicGhvbmVfbnVtYmVyIjogYXR0cmlidXRlUmV0cmlldmVyLmN1cnJ5KCJ0ZWxlcGhvbmVudW1iZXIiKSwKICAgICAgICAiZ2l2ZW5fbmFtZSI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgiZ2l2ZW5uYW1lIiksCiAgICAgICAgInpvbmVpbmZvIjogYXR0cmlidXRlUmV0cmlldmVyLmN1cnJ5KCJwcmVmZXJyZWR0aW1lem9uZSIpLAogICAgICAgICJ1aWQiOiBhdHRyaWJ1dGVSZXRyaWV2ZXIuY3VycnkoImVtcGxveWVlTnVtYmVyIiksCiAgCQkiZmFtaWx5X25hbWUiOiBhdHRyaWJ1dGVSZXRyaWV2ZXIuY3VycnkoInNuIiksCiAgICAgICAgImxvY2FsZSI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgicHJlZmVycmVkbG9jYWxlIiksCiAgICAgICAgIm5hbWUiOiBhdHRyaWJ1dGVSZXRyaWV2ZXIuY3VycnkoImNuIiksCiAgICAgICAgInJvbGVzIjogeyBjbGFpbSwgaWRlbnRpdHksIHJlcXVlc3RlZCAtPgogICAgICAgICAgICBpZGVudGl0eS5nZXRNZW1iZXJzaGlwcyhJZFR5cGUuR1JPVVApLmNvbGxlY3QgeyBncm91cCAtPiBncm91cC5uYW1lIH0KICAgICAgICB9ICAgICAgICAKXQoKLy8ge3Njb3BlfTogWyB7Y2xhaW19LCAuLi4gXQpzY29wZUNsYWltc01hcCA9IFsKICAgICAgICAiZW1haWwiOiBbICJlbWFpbCIgXSwKICAgICAgICAiYWRkcmVzcyI6IFsgImFkZHJlc3MiIF0sCiAgICAgICAgInBob25lIjogWyAicGhvbmVfbnVtYmVyIiBdLAogICAgICAgICJwcm9maWxlIjogWyAiZ2l2ZW5fbmFtZSIsICJ6b25laW5mbyIsICJmYW1pbHlfbmFtZSIsICJsb2NhbGUiLCAibmFtZSIsICJ1aWQiIF0sCiAgICAgICAgInJvbGVzIjogWyAicm9sZXMiIF0sCiAgCQkiaWRtVWlkIjogWyAidWlkIiBdCl0KCgppZiAobG9nZ2VyLm1lc3NhZ2VFbmFibGVkKCkpIHsKICAgIHNjb3Blcy5maW5kQWxsIHsgcyAtPiAhKCJvcGVuaWQiLmVxdWFscyhzKSB8fCBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzKSkgfS5lYWNoIHsgcyAtPgogICAgICAgIGxvZ2dlci5tZXNzYWdlKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOjpNZXNzYWdlOiBzY29wZSBub3QgYm91bmQgdG8gY2xhaW1zOiAkcyIpCiAgICB9Cn0KCmRlZiBjb21wdXRlQ2xhaW0gPSB7IGNsYWltLCByZXF1ZXN0ZWRWYWx1ZXMgLT4KICAgIHRyeSB7CiAgICAgICAgWyBjbGFpbSwgY2xhaW1BdHRyaWJ1dGVzLmdldChjbGFpbSkoY2xhaW0sIGlkZW50aXR5LCByZXF1ZXN0ZWRWYWx1ZXMpIF0KICAgIH0gY2F0Y2ggKElkUmVwb0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBVbmFibGUgdG8gcmV0cmlldmUgYXR0cmlidXRlPSRhdHRyaWJ1dGUiLCBlKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChTU09FeGNlcHRpb24gZSkgewogICAgICAgIGlmIChsb2dnZXIud2FybmluZ0VuYWJsZWQoKSkgewogICAgICAgICAgICBsb2dnZXIud2FybmluZygiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTogVW5hYmxlIHRvIHJldHJpZXZlIGF0dHJpYnV0ZT0kYXR0cmlidXRlIiwgZSk7CiAgICAgICAgfQogICAgfQp9CgpkZWYgY29tcHV0ZWRDbGFpbXMgPSBzY29wZXMuZmluZEFsbCB7IHMgLT4gISJvcGVuaWQiLmVxdWFscyhzKSAmJiBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzKSB9LmluamVjdChjbGFpbXMpIHsgbWFwLCBzIC0+CiAgICBzY29wZUNsYWltcyA9IHNjb3BlQ2xhaW1zTWFwLmdldChzKQogICAgbWFwIDw8IHNjb3BlQ2xhaW1zLmZpbmRBbGwgeyBjIC0+ICFyZXF1ZXN0ZWRDbGFpbXMuY29udGFpbnNLZXkoYykgfS5jb2xsZWN0RW50cmllcyhbOl0pIHsgY2xhaW0gLT4gY29tcHV0ZUNsYWltKGNsYWltLCBudWxsKSB9Cn0uZmluZEFsbCB7IG1hcCAtPiBtYXAudmFsdWUgIT0gbnVsbCB9IDw8IHJlcXVlc3RlZENsYWltcy5jb2xsZWN0RW50cmllcyhbOl0pIHsgY2xhaW0sIHJlcXVlc3RlZFZhbHVlIC0+CiAgICBjb21wdXRlQ2xhaW0oY2xhaW0sIHJlcXVlc3RlZFZhbHVlKQp9CgpkZWYgY29tcG9zaXRlU2NvcGVzID0gc2NvcGVDbGFpbXNNYXAuZmluZEFsbCB7IHNjb3BlIC0+CiAgICBzY29wZXMuY29udGFpbnMoc2NvcGUua2V5KQp9CgpyZXR1cm4gbmV3IFVzZXJJbmZvQ2xhaW1zKChNYXApY29tcHV0ZWRDbGFpbXMsIChNYXApY29tcG9zaXRlU2NvcGVzKQ==",
    "default" : true,
    "language" : "GROOVY",
    "context" : "OIDC_CLAIMS",
    "createdBy" : "null",
    "creationDate" : 0,
    "lastModifiedBy" : "null",
    "lastModifiedDate" : 0
  }
}